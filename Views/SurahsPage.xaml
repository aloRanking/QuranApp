<rxui:ReactiveContentPage
    x:Class="QuranApp.Views.SurahsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:rxui="clr-namespace:ReactiveUI.Maui;assembly=ReactiveUI.Maui"
    xmlns:viewmodel="clr-namespace:QuranApp.ViewModels"
    Title="Quran"
    x:TypeArguments="viewmodel:SurahsViewModel">

    <ContentPage.ToolbarItems>
        <ToolbarItem Command="{Binding SettingSelectedCommand}" Text="Settings" />

    </ContentPage.ToolbarItems>


    <Grid BackgroundColor="{Binding Theme.CurrentTheme.Background}" RowDefinitions="Auto,*">
        <Grid.Resources>
            <Style TargetType="Label">
                <Setter Property="TextColor" Value="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:SurahsViewModel}}, Path=Theme.CurrentTheme.Text}" />
            </Style>
        </Grid.Resources>

        <Grid  Padding="10">
            
            <Border
                Padding="5"
               
                BackgroundColor="{Binding Theme.CurrentTheme.Background}"
                StrokeShape="RoundRectangle 12"
                StrokeThickness="0">
                <Border.Resources>
            <Style TargetType="Entry">
                <Setter Property="TextColor" Value="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:SurahsViewModel}}, Path=Theme.CurrentTheme.Text}" />
            </Style>
            <Style TargetType="Button">
                <Setter Property="TextColor" Value="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:SurahsViewModel}}, Path=Theme.CurrentTheme.Text}" />
            </Style>
        </Border.Resources>

                <Grid ColumnDefinitions="Auto,*,Auto" VerticalOptions="Center">

                    <Label
                        Margin="0,0,8,0"
                        FontSize="18"
                        Text="ðŸ”"
                        VerticalOptions="Center" />


                    <Entry
                        x:Name="SearchEntry"
                        Grid.Column="1"
                        BackgroundColor="Transparent"
                        FontSize="16"
                        Placeholder="Search Surahs..."
                        PlaceholderColor="Gray"
                        Text="{Binding SearchText, Mode=TwoWay}"
                         />


                    <Button
                        Grid.Column="2"
                        BackgroundColor="Transparent"
                        Command="{Binding CancelSearchCommand}"
                        Text="Cancel"
                         />
                </Grid>
            </Border>

        </Grid>


        <Grid Grid.Row="1" BackgroundColor="{Binding Theme.CurrentTheme.Background}">

            <Grid.Resources>
                <Style TargetType="Label">
                    <Setter Property="TextColor" Value="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:SurahsViewModel}}, Path=Theme.CurrentTheme.Text}" />
                </Style>
                <Style TargetType="Span">
                    <Setter Property="TextColor" Value="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:SurahsViewModel}}, Path=Theme.CurrentTheme.Text}" />
                </Style>
            </Grid.Resources>
            <ActivityIndicator
                HorizontalOptions="Center"
                IsRunning="{Binding IsLoading}"
                IsVisible="{Binding IsLoading}"
                VerticalOptions="Center"
                Color="{AppThemeBinding Light=Blue,
                                        Dark=LightBlue}" />

            <CollectionView ItemsSource="{Binding FilteredSurahs}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />

                            </Grid.RowDefinitions>

                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:SurahsViewModel}}, Path=SurahSelectedCommand}" CommandParameter="{Binding .}" />
                            </Grid.GestureRecognizers>

                            <Border
                                Grid.Column="0"
                                Margin="0,0,10,0"
                                Padding="5"
                                BackgroundColor="{AppThemeBinding Light=LightBlue,
                                                                  Dark=SlateGray}"
                                HorizontalOptions="Center"
                                StrokeShape="RoundRectangle 12"
                                VerticalOptions="Center">
                                <Label
                                    Margin="5"
                                    FontAttributes="Bold"
                                    FontSize="16"
                                    HorizontalOptions="Center"
                                    Text="{Binding Id}"
                                    TextColor="{AppThemeBinding Light=DarkSlateGray,
                                                                Dark=LightGray}"
                                    VerticalOptions="Center" />

                            </Border>

                            <Grid
                                Grid.Row="0"
                                Grid.Column="1"
                                Padding="5"
                                RowDefinitions="Auto,Auto">

                                <Label
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    FontAttributes="Bold"
                                    FontSize="16"
                                    Text="{Binding Anglicised}" />



                                <Label Grid.Row="1" Grid.Column="1">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span
                                                FontSize="12"
                                                Text="{Binding English, StringFormat='({0})'}"
                                                 />
                                            <Span
                                                FontSize="12"
                                                Text=" - "
                                                 />
                                            <Span
                                                FontSize="12"
                                                Text="{Binding AyahCount, StringFormat='{0} Ayahs'}"
                                                 />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                            </Grid>


                            <Label
                                Grid.Column="2"
                                FontAttributes="Bold"
                                FontSize="20"
                                Text="{Binding Arabic}"
                                 />

                            <BoxView
                                Grid.Row="1"
                                Grid.ColumnSpan="3"
                                Margin="0,20,0,0"
                                HeightRequest="1"
                                Color="{AppThemeBinding Light=LightGray,
                                                        Dark=#555555}" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </Grid>


    </Grid>





</rxui:ReactiveContentPage>